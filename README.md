# 마스토돈 스프레드시트 봇

구글 스프레드시트와 연동하여 키워드 기반으로 응답하는 마스토돈 봇입니다.

## 기능

- 구글 스프레드시트에서 키워드-응답 데이터 읽기
- 마스토돈에서 멘션 시 키워드 매칭 후 자동 응답
- **가챠 시스템**: '가챠' 키워드로 확률형 뽑기 기능
- '획득' 키워드가 포함된 응답 시 별도 시트에 로그 기록

## 설치

1. 필요한 패키지 설치:
```bash
pip install -r requirements.txt
```

2. 환경 변수 설정:
```bash
cp .env.example .env
```

`.env` 파일을 편집하여 다음 값들을 설정:

- `MASTODON_ACCESS_TOKEN`: 마스토돈 액세스 토큰
- `MASTODON_API_BASE_URL`: 마스토돈 인스턴스 URL
- `GOOGLE_SERVICE_ACCOUNT_FILE`: 구글 서비스 계정 JSON 파일 경로
- `SPREADSHEET_ID`: 구글 스프레드시트 ID
- `KEYWORDS_SHEET_NAME`: 키워드 시트 이름 (기본: keywords)
- `ACQUISITION_LOG_SHEET_NAME`: 획득 로그 시트 이름 (기본: acquisition_log)
- `GACHA_SHEET_NAME`: 가챠 아이템 시트 이름 (기본: 가챠)

## 구글 스프레드시트 설정

### 키워드 시트 구조
```
A열: 키워드
B열: 응답
```

예시:
```
안녕        | 안녕하세요! 😊
도움말      | 무엇을 도와드릴까요?
아이템      | 레어 아이템을 획득했습니다!
```

### 가챠 시트 구조
가챠 아이템들을 A열에 세로로 나열합니다:
```
A1: SSR 아이템 1 (1-5번줄: 1% 확률)
A2: SSR 아이템 2
...
A6: SR 아이템 1 (6-15번줄: 5% 확률)
...
A16: R 아이템 1 (16-30번줄: 15% 확률)
...
A31: N 아이템 1 (31-50번줄: 79% 확률)
...
```

### 획득 로그 시트 구조
자동으로 생성되며 다음 구조를 가집니다:
```
A열: 시간
B열: 사용자
C열: 획득 아이템
```

## 구글 API 설정

1. [Google Cloud Console](https://console.cloud.google.com/)에서 프로젝트 생성
2. Google Sheets API 활성화
3. 서비스 계정 생성 및 JSON 키 다운로드
4. 스프레드시트를 서비스 계정과 공유

## 마스토돈 API 설정

1. 마스토돈 인스턴스의 개발자 설정에서 애플리케이션 등록
2. 액세스 토큰 생성
3. 봇 계정 생성 권장

## 실행

### Linux/Mac (터미널)
```bash
python main.py
```

### Windows (CMD)
```cmd
scripts\windows\start_bot.bat
```

또는 직접 실행:
```cmd
cd C:\mastodon-bot
call venv\Scripts\activate.bat
python main.py
```

## 사용법

1. 마스토돈에서 봇을 멘션하면서 키워드 입력
2. 봇이 스프레드시트에서 매칭되는 응답 찾아서 답변
3. '획득'이 포함된 응답의 경우 자동으로 로그 기록

예시:
```
@bot 안녕         -> "안녕하세요! 😊"
@bot 아이템       -> "레어 아이템을 획득했습니다!" (로그에 기록됨)
@bot 가챠         -> "✨🌟 [SSR] 전설의 검을 획득했습니다!" (확률적으로 결정)
```

## 가챠 시스템

멘션에 '가챠' 키워드가 포함되면 확률형 뽑기를 실행합니다:

- **SSR (1%)**: 1-5번 줄 아이템 ✨🌟
- **SR (5%)**: 6-15번 줄 아이템 ⭐  
- **R (15%)**: 16-30번 줄 아이템 💫
- **N (79%)**: 31-50번 줄 아이템 ⚪

모든 가챠 결과는 자동으로 획득 로그에 기록됩니다.

## 24시간 운영 가이드

### Windows PC에서 24시간 운영
- **빠른 시작**: [Windows 배포 가이드](./WINDOWS_DEPLOYMENT_GUIDE.md)
- Windows 서비스 등록으로 자동 시작/재시작
- 예약 작업을 통한 상태 모니터링
- GUI 도구로 쉬운 관리

### 클라우드 서버(GCE)에서 24시간 운영  
- **상세 가이드**: [GCE 배포 가이드](./GCE_DEPLOYMENT_GUIDE.md)
- **빠른 시작**: [배포 README](./DEPLOYMENT_README.md) 
- systemd 서비스로 안정적 운영
- 자동 보안 강화 및 모니터링

## 주요 기능별 사용법

### 🎯 기본 사용법
```
@봇이름 안녕        → "안녕하세요! 😊"
@봇이름 도움말      → "무엇을 도와드릴까요?"
@봇이름 아이템      → "레어 아이템을 획득했습니다!" (로그 기록)
```

### 🎲 가챠 시스템
```
@봇이름 가챠        → "✨🌟 [SSR] 전설의 검을 획득했습니다!" (확률적)
```

가챠 확률:
- **SSR (1%)**: 1-5번째 줄 아이템 ✨🌟
- **SR (5%)**: 6-15번째 줄 아이템 ⭐
- **R (15%)**: 16-30번째 줄 아이템 💫  
- **N (79%)**: 31-50번째 줄 아이템 ⚪

## 주의사항

- 봇은 실시간으로 멘션을 감지하므로 계속 실행되어야 합니다
- 구글 API 할당량을 고려하여 사용하세요
- 마스토돈 인스턴스의 API 제한을 확인하세요
- 24시간 운영을 위해서는 위의 배포 가이드를 참고하세요